# 🔍RootFreeFireWall
`Android`免免免免免免免`root`防火墙，可以监控、拦截应用流量，还能拦截垃圾短信

---

# 💥原理
## 应用流量拦截
想要实现`Android`系统上的防火墙，一般有两种思路：
* `root`之后使用一些`linux`内核级别的库函数实现包拦截、过滤等
* 免`root`情况下使用`VpnService`可以获取物理网卡要发出去的包，进而实现包拦截、过滤

在`Android`系统中，应用往往都是使用`http`协议进行数据的收发，另外，在`Android`系统中，往往也不用考虑入站数据，因为系统中不可能部署一个服务器应用。由于这样的特殊性，`Android`系统中往往不会针对套接字单元设置防火墙规则，而是简单地设置应用级别的防火墙规则。

这里说一下`VpnService`的原理，`VpnService`是一个`Android`后期版本提供的`API`，他是一个继承于`Service`的服务，当用户实现一个继承自`VpnService`的服务类时，可以建立`Vpn`连接，也就是系统设置中的`VPN`一栏里的设置。

当建立`Vpn`连接之后，可以获取到一个物理网卡的文件描述符，我们可以使用这个文件描述符建立`IO`通道，每一次对这个通道调用`read()`，可以获取到一个本来将要从物理网卡发送到外部网络的`IP`数据包，每一次对这个通道调用`write()`，可以写入一个本来将要从外部网络写入物理网卡的数据包。这一操作是由`VpnService`虚拟出来一张虚拟网卡实现的，整体来看就是这样一张图：

```
    phy     ->    tun0   ->    network
   物理网卡  <-   虚拟网卡  <-    外部网络
```

实际上，我们拿到数据包之后，要把数据包拆了，然后重新封装，再以`tun0`的身份发送给`network`，然后收到`network`回应的包之后，也要拆了，然后重新封装，假装包是直接从`network`发给`phy`的，最后再把那个包写回`phy`。这就是整个流程，`IP`包是无连接的，但是考虑到上层有一些协议是面向连接的，比如`TCP`，我们在`tun0`与`network`之间的通信，还要手动实现三次握手、四次挥手、连接管理等。这就相当于要实现一个简化版的`TCP/IP`技术栈。

最后的效果就是`phy`和`network`相互以为自己再与对方通信，但实际上是`phy`与`tun0`通信、`network`也与`tun0`通信。这样一种思想往往用于搭建`Vpn`，但是，我们只要在`phy`到`tun0`的链路上做手脚，就能断开他与外部的连接，另外，如果在整条通信链路上予以日志记录，就能实现监控的目的。这就是应用流量拦截的思想。

## 垃圾短信拦截
`todo`

# TODO!!!
