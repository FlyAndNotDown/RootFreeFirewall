# ğŸ”RootFreeFireWall
`Android`å…å…å…å…å…å…å…`root`é˜²ç«å¢™ï¼Œå¯ä»¥ç›‘æ§ã€æ‹¦æˆªåº”ç”¨æµé‡ï¼Œè¿˜èƒ½æ‹¦æˆªåƒåœ¾çŸ­ä¿¡

---

# ğŸ’¥åŸç†
## åº”ç”¨æµé‡æ‹¦æˆª
æƒ³è¦å®ç°`Android`ç³»ç»Ÿä¸Šçš„é˜²ç«å¢™ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ€è·¯ï¼š
* `root`ä¹‹åä½¿ç”¨ä¸€äº›`linux`å†…æ ¸çº§åˆ«çš„åº“å‡½æ•°å®ç°åŒ…æ‹¦æˆªã€è¿‡æ»¤ç­‰
* å…`root`æƒ…å†µä¸‹ä½¿ç”¨`VpnService`å¯ä»¥è·å–ç‰©ç†ç½‘å¡è¦å‘å‡ºå»çš„åŒ…ï¼Œè¿›è€Œå®ç°åŒ…æ‹¦æˆªã€è¿‡æ»¤

åœ¨`Android`ç³»ç»Ÿä¸­ï¼Œåº”ç”¨å¾€å¾€éƒ½æ˜¯ä½¿ç”¨`http`åè®®è¿›è¡Œæ•°æ®çš„æ”¶å‘ï¼Œå¦å¤–ï¼Œåœ¨`Android`ç³»ç»Ÿä¸­ï¼Œå¾€å¾€ä¹Ÿä¸ç”¨è€ƒè™‘å…¥ç«™æ•°æ®ï¼Œå› ä¸ºç³»ç»Ÿä¸­ä¸å¯èƒ½éƒ¨ç½²ä¸€ä¸ªæœåŠ¡å™¨åº”ç”¨ã€‚ç”±äºè¿™æ ·çš„ç‰¹æ®Šæ€§ï¼Œ`Android`ç³»ç»Ÿä¸­å¾€å¾€ä¸ä¼šé’ˆå¯¹å¥—æ¥å­—å•å…ƒè®¾ç½®é˜²ç«å¢™è§„åˆ™ï¼Œè€Œæ˜¯ç®€å•åœ°è®¾ç½®åº”ç”¨çº§åˆ«çš„é˜²ç«å¢™è§„åˆ™ã€‚

è¿™é‡Œè¯´ä¸€ä¸‹`VpnService`çš„åŸç†ï¼Œ`VpnService`æ˜¯ä¸€ä¸ª`Android`åæœŸç‰ˆæœ¬æä¾›çš„`API`ï¼Œä»–æ˜¯ä¸€ä¸ªç»§æ‰¿äº`Service`çš„æœåŠ¡ï¼Œå½“ç”¨æˆ·å®ç°ä¸€ä¸ªç»§æ‰¿è‡ª`VpnService`çš„æœåŠ¡ç±»æ—¶ï¼Œå¯ä»¥å»ºç«‹`Vpn`è¿æ¥ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿè®¾ç½®ä¸­çš„`VPN`ä¸€æ é‡Œçš„è®¾ç½®ã€‚

å½“å»ºç«‹`Vpn`è¿æ¥ä¹‹åï¼Œå¯ä»¥è·å–åˆ°ä¸€ä¸ªç‰©ç†ç½‘å¡çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦å»ºç«‹`IO`é€šé“ï¼Œæ¯ä¸€æ¬¡å¯¹è¿™ä¸ªé€šé“è°ƒç”¨`read()`ï¼Œå¯ä»¥è·å–åˆ°ä¸€ä¸ªæœ¬æ¥å°†è¦ä»ç‰©ç†ç½‘å¡å‘é€åˆ°å¤–éƒ¨ç½‘ç»œçš„`IP`æ•°æ®åŒ…ï¼Œæ¯ä¸€æ¬¡å¯¹è¿™ä¸ªé€šé“è°ƒç”¨`write()`ï¼Œå¯ä»¥å†™å…¥ä¸€ä¸ªæœ¬æ¥å°†è¦ä»å¤–éƒ¨ç½‘ç»œå†™å…¥ç‰©ç†ç½‘å¡çš„æ•°æ®åŒ…ã€‚è¿™ä¸€æ“ä½œæ˜¯ç”±`VpnService`è™šæ‹Ÿå‡ºæ¥ä¸€å¼ è™šæ‹Ÿç½‘å¡å®ç°çš„ï¼Œæ•´ä½“æ¥çœ‹å°±æ˜¯è¿™æ ·ä¸€å¼ å›¾ï¼š

```
    phy     ->    tun0   ->    network
   ç‰©ç†ç½‘å¡  <-   è™šæ‹Ÿç½‘å¡  <-    å¤–éƒ¨ç½‘ç»œ
```

å®é™…ä¸Šï¼Œæˆ‘ä»¬æ‹¿åˆ°æ•°æ®åŒ…ä¹‹åï¼Œè¦æŠŠæ•°æ®åŒ…æ‹†äº†ï¼Œç„¶åé‡æ–°å°è£…ï¼Œå†ä»¥`tun0`çš„èº«ä»½å‘é€ç»™`network`ï¼Œç„¶åæ”¶åˆ°`network`å›åº”çš„åŒ…ä¹‹åï¼Œä¹Ÿè¦æ‹†äº†ï¼Œç„¶åé‡æ–°å°è£…ï¼Œå‡è£…åŒ…æ˜¯ç›´æ¥ä»`network`å‘ç»™`phy`çš„ï¼Œæœ€åå†æŠŠé‚£ä¸ªåŒ…å†™å›`phy`ã€‚è¿™å°±æ˜¯æ•´ä¸ªæµç¨‹ï¼Œ`IP`åŒ…æ˜¯æ— è¿æ¥çš„ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ä¸Šå±‚æœ‰ä¸€äº›åè®®æ˜¯é¢å‘è¿æ¥çš„ï¼Œæ¯”å¦‚`TCP`ï¼Œæˆ‘ä»¬åœ¨`tun0`ä¸`network`ä¹‹é—´çš„é€šä¿¡ï¼Œè¿˜è¦æ‰‹åŠ¨å®ç°ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ã€è¿æ¥ç®¡ç†ç­‰ã€‚è¿™å°±ç›¸å½“äºè¦å®ç°ä¸€ä¸ªç®€åŒ–ç‰ˆçš„`TCP/IP`æŠ€æœ¯æ ˆã€‚

æœ€åçš„æ•ˆæœå°±æ˜¯`phy`å’Œ`network`ç›¸äº’ä»¥ä¸ºè‡ªå·±å†ä¸å¯¹æ–¹é€šä¿¡ï¼Œä½†å®é™…ä¸Šæ˜¯`phy`ä¸`tun0`é€šä¿¡ã€`network`ä¹Ÿä¸`tun0`é€šä¿¡ã€‚è¿™æ ·ä¸€ç§æ€æƒ³å¾€å¾€ç”¨äºæ­å»º`Vpn`ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬åªè¦åœ¨`phy`åˆ°`tun0`çš„é“¾è·¯ä¸Šåšæ‰‹è„šï¼Œå°±èƒ½æ–­å¼€ä»–ä¸å¤–éƒ¨çš„è¿æ¥ï¼Œå¦å¤–ï¼Œå¦‚æœåœ¨æ•´æ¡é€šä¿¡é“¾è·¯ä¸Šäºˆä»¥æ—¥å¿—è®°å½•ï¼Œå°±èƒ½å®ç°ç›‘æ§çš„ç›®çš„ã€‚è¿™å°±æ˜¯åº”ç”¨æµé‡æ‹¦æˆªçš„æ€æƒ³ã€‚

## åƒåœ¾çŸ­ä¿¡æ‹¦æˆª
åœ¨`Android 4.4`ä»¥å‰ï¼Œæ¯æ”¶åˆ°ä¸€æ¡çŸ­ä¿¡ï¼Œç³»ç»Ÿéƒ½ä¼šå‘å‡ºä¸€ä¸ª`SMS_RECEIVED`å¹¿æ’­ï¼Œåªè¦å£°æ˜äº†æƒé™ï¼Œä»»ä½•åº”ç”¨éƒ½èƒ½å¤Ÿæ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨æ¥æ¥å—è¿™ä¸ªå¹¿æ’­ï¼Œå¹¶ä¸”æ‰€æœ‰åº”ç”¨æ ¹æ®å…¶å®šä¹‰çš„ä¼˜å…ˆçº§è¿›è¡Œä¼ é€’å¼å¹¿æ’­ã€‚æœ€å¯æ€•çš„æ˜¯ï¼Œ`SMS_RECEIVED`è¿™ä¸€å¹¿æ’­ï¼Œå¹¶ä¸åªæ˜¯åªè¯»çš„ï¼Œä¼˜å…ˆçº§æ¯”è¾ƒé«˜çš„åº”ç”¨ï¼Œå¯ä»¥ç¯¡æ”¹çŸ­ä¿¡å†…å®¹ã€é˜»æ­¢çŸ­ä¿¡å¹¿æ’­ç»§ç»­ä¼ æ’­ã€‚

è¿™æ ·å¦‚æœç”¨æˆ·æ²¡æœ‰æ³¨æ„å°±æŠŠæƒé™ç»™äºˆç»™è¿™ç±»åº”ç”¨ï¼Œé‚£ä¹ˆè¿™äº›åº”ç”¨å¯èƒ½æ½œä¼åœ¨ç”¨æˆ·çš„åº”ç”¨åˆ—è¡¨é‡Œé¢ï¼Œå½±å“æ­£å¸¸çŸ­ä¿¡åº”ç”¨çš„å·¥ä½œã€‚

åæ¥`Android`è€ƒè™‘åˆ°å®‰å…¨é—®é¢˜ï¼Œåœ¨`Android 4.4`ä»¥åå¼•å…¥äº†ä¸€ä¸ª`é»˜è®¤çŸ­ä¿¡åº”ç”¨`çš„æ¦‚å¿µï¼ŒåŸæ¥çš„`SMS_RECEIVED`å¹¿æ’­ä¹Ÿè¢«æ‹†åˆ†æˆäº†ä¸¤éƒ¨åˆ†ï¼š
* `SMS_DELIVER`ï¼š çŸ­ä¿¡é€è¾¾æ—¶çš„å¹¿æ’­
* `SMS_RECEIVED`ï¼š çŸ­ä¿¡`content URI`ä¸­å¯¹åº”å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶æ”¶åˆ°çš„å¹¿æ’­

è¿™æ ·ä¸€æ¥ï¼Œåªæœ‰å”¯ä¸€çš„é»˜è®¤çŸ­ä¿¡åº”ç”¨èƒ½å¤Ÿè·å–åˆ°`SMS_DELIVER`å¹¿æ’­ï¼Œå®ƒå¯¹çŸ­ä¿¡ä»ç„¶æ˜¯å¯è¯»å¯å†™çš„ï¼Œå¹¶ä¸”å®ƒè¿˜éœ€è¦è´Ÿè´£å°†æ”¶åˆ°çš„çŸ­ä¿¡æ‹†åŒ…ï¼Œæ ¹æ®æ ¼å¼å¡«å…¥çŸ­ä¿¡çš„`content URI`ä¸­ï¼Œå½“æ­£å¸¸å¡«å…¥æ”¶ä»¶ç®±`URI`ä¸­æ—¶ï¼Œå°±ä¼šè§¦å‘`SMS_RECEIVED`å¹¿æ’­ï¼Œå…¶ä»–çš„åº”ç”¨å¯ä»¥åƒä»¥å‰ä¸€æ ·æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨æ¥æ”¶è¿™ä¸ªå¹¿æ’­ï¼Œè¿™æ—¶å€™çŸ­ä¿¡å¯¹æ™®é€šåº”ç”¨ï¼Œå°±æ˜¯åªè¯»çš„äº†ã€‚

æ‰€ä»¥è¦æ‹¦æˆªåƒåœ¾çŸ­ä¿¡ï¼Œéœ€è¦å°†æˆ‘ä»¬çš„åº”ç”¨æš‚æ—¶æ³¨å†Œä¸ºé»˜è®¤çŸ­ä¿¡åº”ç”¨ï¼Œå…³é—­é˜²ç«å¢™ä¹‹åå†è¿˜åŸã€‚

å¦å¤–ï¼Œæˆ‘ä»¬æ˜¯æ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªåº”ç”¨æ˜¯ä¸æ˜¯åƒåœ¾çŸ­ä¿¡çš„å‘¢ï¼Ÿæˆ‘ä»¬é‡‡ç”¨äº†å¾ˆå¤šå‚å•†é‡‡ç”¨çš„ä¿¡ä»»è¯„ä»·æœºåˆ¶ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬æ˜¯éå¸¸ç®€æ˜“çš„ç‰ˆæœ¬ï¼Œå°±æ˜¯è®¾ç½®ä¸€ä¸ªä¸­å¤®ä¿¡ä»»ç­¾å‘æ¶æ„(å¯ä»¥æ˜¯ä¸€ä¸ªæœåŠ¡å™¨åº”ç”¨)ï¼Œå¼€å§‹é»˜è®¤æ‰€æœ‰çš„æ‰‹æœºå·ä¿¡ç”¨ç¨‹åº¦éƒ½æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯ä¸€æ—¦æ‰‹æœºå·é­åˆ°ä»–äººä¸¾æŠ¥ï¼Œæ‰‹æœºå·çš„è¢«ä¿¡ä»»åº¦å°±ä¼šè¢«é™ä½ã€‚ä¸€æ—¦ä½äºæŸä¸ªç¨‹åº¦ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªæ‰‹æœºå·ä¸å†æ˜¯å€¼å¾—ä¿¡ä»»çš„äº†ï¼Œè¿™æ—¶å€™æ¥è‡ªè¯¥æ‰‹æœºå·çš„ä»»ä½•çŸ­ä¿¡éƒ½ä¼šè¢«æ‹¦æˆªä¸‹æ¥ã€‚

è¿™ä¸€æƒ³æ³•éœ€è¦ä¸€ä¸ªæœåŠ¡å™¨çš„å®ç°ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€æ˜“çš„ç‰ˆæœ¬ï¼Œä»“åº“åœ¨è¿™é‡Œï¼Œåé¢ä¹Ÿä¼šè¯´åˆ°å¦‚ä½•éƒ¨ç½²ï¼š[github-FlyAndNotDown-RffSmsInterceptorBackend](https://github.com/FlyAndNotDown/rff-sms-interceptor-backend)ä»¥åŠé…åˆè¿™ä¸ªé¡¹ç›®ä½¿ç”¨

# ğŸ’»ç¼–è¯‘/å‘è¡Œç‰ˆ
## è‡ªå·±ç¼–è¯‘`Debug`ç‰ˆ
ä½ åªéœ€è¦å®‰è£…`Android Studio`ï¼Œç„¶åå…‹éš†æˆ‘çš„é¡¹ç›®ï¼Œå°†å…¶å¯¼å…¥`Android Studio`ï¼Œç„¶å`build`å³å¯åœ¨ä½ æ‰‹æœºæˆ–è€…ä½ çš„è™šæ‹Ÿæœºä¸Šçœ‹åˆ°æ•ˆæœï¼Œå»ºè®®ä½¿ç”¨`Android 7.0`åŠä»¥ä¸Šç‰ˆæœ¬çš„æ‰‹æœºè¿›è¡Œè°ƒè¯•ã€‚

å¦‚æœç¼–è¯‘ä¸æˆåŠŸï¼Œä½ éœ€è¦æ£€æŸ¥ä½ è‡ªå·±çš„`gradle`ç‰ˆæœ¬å’Œ`ADK`ç¯å¢ƒï¼Œå¦‚æœè¿˜æ˜¯ä¸è¡Œå¯ä»¥è‡ªè¡Œä¿®æ”¹`build.gradle`æ–‡ä»¶ï¼Œé™ä½`API`ç‰ˆæœ¬ã€‚

## `Release`ç‰ˆæœ¬
å¦‚æœä½ æƒ³å°é²œï¼Œè‡ªå·±ä½¿ç”¨æˆ‘ä»¬é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯·çœ‹è¿™é‡Œï¼š[RFF-Release](https://github.com/FlyAndNotDown/RootFreeFirewall/releases)

# TODO!!!
